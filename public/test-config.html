<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Configuration - Sprintflow</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 24px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        .test-item {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }
        .test-item h3 {
            font-size: 16px;
            margin-bottom: 10px;
            color: #333;
        }
        .status {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status.success {
            background: #4caf50;
            color: white;
        }
        .status.error {
            background: #f44336;
            color: white;
        }
        .status.pending {
            background: #ff9800;
            color: white;
        }
        .detail {
            margin-top: 10px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 5px;
            font-size: 13px;
            font-family: 'Courier New', monospace;
            word-break: break-all;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 13px;
            color: #1976d2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Test de Configuration</h1>
        <p class="subtitle">V√©rification de la configuration de votre application</p>

        <div id="tests"></div>

        <button onclick="runTests()">üîÑ Re-tester</button>

        <div class="info">
            <strong>üí° Astuce:</strong> Si des tests √©chouent, consultez le fichier CONFIGURATION_PRODUCTION.md pour les solutions.
        </div>
    </div>

    <script>
        async function runTests() {
            const testsContainer = document.getElementById('tests');
            testsContainer.innerHTML = '';

            const tests = [
                {
                    name: 'Variables d\'environnement',
                    test: checkEnvVars
                },
                {
                    name: 'Connexion Supabase',
                    test: checkSupabaseConnection
                },
                {
                    name: 'HTTPS',
                    test: checkHTTPS
                },
                {
                    name: 'Connexion Internet',
                    test: checkInternet
                }
            ];

            for (const test of tests) {
                const result = await test.test();
                addTestResult(test.name, result);
            }
        }

        function addTestResult(name, result) {
            const testsContainer = document.getElementById('tests');
            const testItem = document.createElement('div');
            testItem.className = 'test-item';

            const statusClass = result.success ? 'success' : 'error';
            const statusText = result.success ? '‚úÖ OK' : '‚ùå √âCHEC';

            testItem.innerHTML = `
                <h3>${name} <span class="status ${statusClass}">${statusText}</span></h3>
                <div class="detail">${result.message}</div>
            `;

            testsContainer.appendChild(testItem);
        }

        async function checkEnvVars() {
            // R√©cup√©rer les variables depuis le build (inject√©es par Vite)
            const url = window.location.origin;

            // Note: en production, les variables sont compil√©es dans le bundle
            // On ne peut pas les lire directement, mais on peut tester la connexion

            return {
                success: true,
                message: `URL de l'app: ${url}\n\n‚ö†Ô∏è Les variables d'environnement sont compil√©es dans le bundle. Testez la connexion Supabase ci-dessous pour v√©rifier.`
            };
        }

        async function checkSupabaseConnection() {
            try {
                const response = await fetch('https://kqlzvxfdzandgdkqzggj.supabase.co/rest/v1/', {
                    method: 'HEAD',
                    headers: {
                        'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtxbHp2eGZkemFuZGdka3F6Z2dqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE2NTM2ODcsImV4cCI6MjA3NzIyOTY4N30.sOpb5fL1l7-yli2_Lrptz_L7ihGkZxzbGSoW2tYRn_E'
                    }
                });

                if (response.ok || response.status === 200) {
                    return {
                        success: true,
                        message: '‚úÖ Connexion √† Supabase r√©ussie!\nVotre application peut communiquer avec la base de donn√©es.'
                    };
                } else {
                    return {
                        success: false,
                        message: `‚ùå Erreur HTTP ${response.status}\nV√©rifiez la configuration CORS dans Supabase.`
                    };
                }
            } catch (error) {
                return {
                    success: false,
                    message: `‚ùå Impossible de se connecter √† Supabase:\n${error.message}\n\nV√©rifiez:\n1. Les Redirect URLs dans Supabase\n2. La configuration CORS\n3. Votre connexion internet`
                };
            }
        }

        async function checkHTTPS() {
            const isHTTPS = window.location.protocol === 'https:';
            const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';

            if (isHTTPS || isLocalhost) {
                return {
                    success: true,
                    message: isHTTPS
                        ? '‚úÖ HTTPS activ√©\nVotre connexion est s√©curis√©e.'
                        : '‚úÖ En d√©veloppement local (localhost)'
                };
            } else {
                return {
                    success: false,
                    message: '‚ùå HTTPS non activ√©\nL\'authentification Supabase n√©cessite HTTPS en production.'
                };
            }
        }

        async function checkInternet() {
            try {
                await fetch('https://www.google.com/favicon.ico', {
                    mode: 'no-cors',
                    cache: 'no-cache'
                });
                return {
                    success: true,
                    message: '‚úÖ Connexion internet active'
                };
            } catch (error) {
                return {
                    success: false,
                    message: '‚ùå Pas de connexion internet d√©tect√©e'
                };
            }
        }

        // Lancer les tests automatiquement au chargement
        window.addEventListener('load', runTests);
    </script>
</body>
</html>
